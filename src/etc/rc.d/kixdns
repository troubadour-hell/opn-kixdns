#!/bin/sh

# PROVIDE: kixdns
# REQUIRE: LOGIN
# KEYWORD: shutdown

. /etc/rc.subr

name="kixdns"
rcvar="kixdns_enable"

load_rc_config $name

: ${kixdns_enable:="NO"}
: ${kixdns_config:="/usr/local/etc/kixdns/pipeline.json"}

command="/usr/local/bin/kixdns"

# 额外 CLI 参数：listener label / debug / udp-workers
: ${kixdns_listener_label:="default"}
: ${kixdns_debug:="NO"}
: ${kixdns_udp_workers:="0"}

extra_args="--config ${kixdns_config} --listener-label ${kixdns_listener_label}"
if [ "${kixdns_debug}" = "YES" ]; then
    extra_args="${extra_args} --debug"
fi
if [ "${kixdns_udp_workers}" != "0" ]; then
    extra_args="${extra_args} --udp-workers ${kixdns_udp_workers}"
fi

command_args="${extra_args}"

pidfile="/var/run/${name}.pid"

run_rc_command "$1"

